# from init
export REBUILD=${REBUILD-true}
export SKIP_CHECKS=${SKIP_CHECKS-true}

CI_TYPE=${CI_TYPE:-jenkins}

# from buildah-tssc
TAG=$(git rev-parse HEAD)
export IMAGE_URL=${IMAGE_URL-artifactory-docker-artifactory-jcr2.apps.rosa.rhtap-services.xmdt.p3.openshiftapps.com/rhtap/backend-tests-go-czqbezkv:$CI_TYPE-$TAG}
export IMAGE=${IMAGE-$IMAGE_URL}

export DOCKERFILE=${DOCKERFILE-docker/Dockerfile}
export CONTEXT=${CONTEXT-.}
export TLSVERIFY=${TLSVERIFY-true}
export BUILD_ARGS=${BUILD_ARGS-""}
export BUILD_ARGS_FILE=${BUILD_ARGS_FILE-""}

# from ACS_*.*
export DISABLE_ACS=${DISABLE_ACS-false}
# Optionally set ROX_CENTRAL_ENDPOINT here instead of configuring a Jenkins secret
export ROX_CENTRAL_ENDPOINT="central-tssc-acs.apps.rhopp-test-clusterpool-xhp89.rhtap.devcluster.openshift.com:443"
export INSECURE_SKIP_TLS_VERIFY=${INSECURE_SKIP_TLS_VERIFY-true}

# for gitops, if acs scans are set, we still may not want that repo 
# to be updates so include an option to disable

export DISABLE_GITOPS_UPDATE=${DISABLE_GITOPS_UPDATE-false}
export GITOPS_REPO_URL=https://github.com/rhopp-rhtap-testing/backend-tests-go-czqbezkv-gitops

export PARAM_IMAGE=${PARAM_IMAGE-$IMAGE}
# Recompute this every time, otherwise it will be set BEFORE the file exists
# and be stuck at latest
export PARAM_IMAGE_DIGEST=$(cat "$BASE_RESULTS/buildah-tssc/IMAGE_DIGEST" 2>/dev/null || echo "latest")

# From Summary
export SOURCE_BUILD_RESULT_FILE=${SOURCE_BUILD_RESULT_FILE-""}

# gather images params
export CUSTOM_ROOT_CA="-----BEGIN CERTIFICATE-----
MIIDMjCCAhqgAwIBAgIINu+1CiED1scwDQYJKoZIhvcNAQELBQAwNzESMBAGA1UE
CxMJb3BlbnNoaWZ0MSEwHwYDVQQDExhrdWJlLWFwaXNlcnZlci1sYi1zaWduZXIw
HhcNMjUxMTIxMDgwMjU2WhcNMzUxMTE5MDgwMjU2WjA3MRIwEAYDVQQLEwlvcGVu
c2hpZnQxITAfBgNVBAMTGGt1YmUtYXBpc2VydmVyLWxiLXNpZ25lcjCCASIwDQYJ
KoZIhvcNAQEBBQADggEPADCCAQoCggEBANbtXMsscwo82h734VcdG3y5Vt/dLWEs
O47/i/MBgw5i1dufPhyQiLTJMUjN69KcFfr6bYk9rClbY134sP9GECRFJCOrShhu
GarmMdq+ljGIJ8BsnKU6sd+3Sw1NfZqCUeX51HxKb6icUm9f2ZH2hrbqzQO+3Ho+
rbKSg5paV9onQV+Xd9eDYcXnOHWNBpSnw/81hErDvR1rGB9PJFvC67wAoP18EurU
/KmxrLfaJ3FQFovqkFq92pSE8dWQ+LR4D1WYUDG7kC5wDHxhVSeOUgNl9L6ZCfS/
QcMO3C8+v4vQp566UETlw2zUBu6PzZoHPQyibi+PGWsfzOelTiLNiIcCAwEAAaNC
MEAwDgYDVR0PAQH/BAQDAgKkMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFKrD
dWZ3zTgzMY5+AmFyM/8iEKIEMA0GCSqGSIb3DQEBCwUAA4IBAQB2IzB4/1/LOJLd
GLa0+YRkrPR716eSD+XUvFLdYoBtQUCDgy6TbE/wbOgSVTGG6za7J0Ogfjuda82q
yOLTR7W3uNT5GlMBXJpOP7qdakQvaowUE/y6ocOmRA5gaeprvOm81noATVqIvaVg
aoKaX5wmvkHTVI0Oq0a2JhMdSZUqugNCJSMGFB3vzaEHjyJQghSHIYunwfOOssg3
mWMS5Olg0eM6+kV7qYNu4+E2EagfyiBXm7tZ0jiafHXug255ATQHHa869N+2JnOb
31chv5k6hiq2JZ127Gv2WiBxD4v5z1HXumfIXxPtQCIiVbVsUD93GOGi7t6CdYOJ
qGTSjx0W
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDQDCCAiigAwIBAgIITKxP0j36ZjIwDQYJKoZIhvcNAQELBQAwPjESMBAGA1UE
CxMJb3BlbnNoaWZ0MSgwJgYDVQQDEx9rdWJlLWFwaXNlcnZlci1sb2NhbGhvc3Qt
c2lnbmVyMB4XDTI1MTEyMTA4MDI1NloXDTM1MTExOTA4MDI1NlowPjESMBAGA1UE
CxMJb3BlbnNoaWZ0MSgwJgYDVQQDEx9rdWJlLWFwaXNlcnZlci1sb2NhbGhvc3Qt
c2lnbmVyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsngJrWHJoaa1
l5HA5uJaMy7ln9xDSvhyJm6JuqvEk9c1HAQXOwA8euy4Fw6BiI44z0HK5wK4GjfU
R3O/pYwp+eO7TBC63/hrzZ29Pjb1O1y9PHhGzH9hzRxvD1zkNKrFLH8mpmAcrUKD
Ti4PcJbZkoVn0hrOoSH4SyUD4edkpKOZLknp/0CJxrmrzxf7+UT93AvSVFGaIFoX
SbYDS55JGXHVVnd4N7drL/vAa/V+8S/3Zy1dr/s9SLRKQMTN3szaMciKinBpOe3m
CZRXjQeRuS9iyMtCxI/+NZIV89axnNXU3zqy9PUCWSwXLo3ODzu2jekg7cxdKqgg
Ni6YpGNaTQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYDVR0TAQH/BAUwAwEB
/zAdBgNVHQ4EFgQUvGmBJs4sBQUrxhxU7ISVQATi5rMwDQYJKoZIhvcNAQELBQAD
ggEBAKAtbuF8Fb3July73tcVr9SXE0r2fGggrmS2sA1TR/2W8wLEG8wy3Ohi2wHE
EcqSf9cpK4Cr+X2rD95vZLMSfyoKea9SZVDuFpKTT76ZYtRgSX1YzormxStIcW28
s9k5Uh9yOcqNHMLw/UgbXTicYYDhVhDac1AbpcI5KWNftvVGy1gt9J7chj5u4qR2
jq7hkCPObB5Xyh8oTRzg9Et1bsHiTqOll3MIgNOSQVmmWj7fU+RehOIHUACeZx1d
6uga7I/Nw10hJ+QSKgnTwavbbJa7nxilTM6FeGZo9LxoWDXp7oXUb3cjA9UBuLCj
Qz3OhStXk7YdM/8yjUJqtdnPMvY=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDTDCCAjSgAwIBAgIIAoJ+nx/Jv7cwDQYJKoZIhvcNAQELBQAwRDESMBAGA1UE
CxMJb3BlbnNoaWZ0MS4wLAYDVQQDEyVrdWJlLWFwaXNlcnZlci1zZXJ2aWNlLW5l
dHdvcmstc2lnbmVyMB4XDTI1MTEyMTA4MDI1NloXDTM1MTExOTA4MDI1NlowRDES
MBAGA1UECxMJb3BlbnNoaWZ0MS4wLAYDVQQDEyVrdWJlLWFwaXNlcnZlci1zZXJ2
aWNlLW5ldHdvcmstc2lnbmVyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAtHBLawmmgNizuiWewvbm0xBSPoi6pOEgZotfZ09cnosLS2dpgGXvjLQ86YQq
FJGkbRBRaS761K1FFI3JEaOdghNV9WLImmIvp/ZY6h0xGCQgUEnkKVAy9sPYWtZI
ITx3j9nuyHzlTnY4YBHY4GCWe3BFa/yyzQCqCXorKFNmwY00a7mslFkHjuHAz/nF
AzTLFo0fgAXIjuDOYfjYOj33hiO+i6d7UfQUg7wpi9AndMMkBfUdN//p9vasDqw7
pW0PSiCJ+u2sbZeThY6GFBrkkZrEpbSKKHaNHC9BoCngLi4YKileZmJrEJtnbD6A
5WpcmjeB+HG0ZNnPa6fO1IQIpQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAqQwDwYD
VR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUoMMsklCY/pNTd1jQ94SMvTuhvnEwDQYJ
KoZIhvcNAQELBQADggEBAE2bGq/Pe5+/gMoFfhVGK+vZXXVpb1VTS2DyhnFVTkjd
YGlrEURjDE/Tk+mJRHo5Cn0qNCPyG44k2wIr8ClhwGq9plfhrkTSaN/RLSDSOXxN
o1vpJtCc5l+gshNB7AxyR3RGOVvOg6rkWAWLBdOMDw4NlG/cIyVONjZvl98ow7jK
iXjGHCkV7dyIasJALw2rGr2MhDbPpd8Yaf1ahEkk9tLSgWysuZ7tG6hJqh5+QcnF
BnG8Z1wFPZjCQzvl4S4og8YmM6PK2UBx7T/A0Cxyfz0CDcUDu0/f3pmpVAzQlRD2
o4n217f4zK+0GHllJpXz0NKqPs9Y+RsF2wqvKLio1PQ=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDlzCCAn+gAwIBAgIIM6KCsKe67qgwDQYJKoZIhvcNAQELBQAwWTFXMFUGA1UE
AwxOb3BlbnNoaWZ0LWt1YmUtYXBpc2VydmVyLW9wZXJhdG9yX2xvY2FsaG9zdC1y
ZWNvdmVyeS1zZXJ2aW5nLXNpZ25lckAxNzYzNzEzMDgxMB4XDTI1MTEyMTA4MTgw
MVoXDTM1MTExOTA4MTgwMlowWTFXMFUGA1UEAwxOb3BlbnNoaWZ0LWt1YmUtYXBp
c2VydmVyLW9wZXJhdG9yX2xvY2FsaG9zdC1yZWNvdmVyeS1zZXJ2aW5nLXNpZ25l
ckAxNzYzNzEzMDgxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAys76
BDiIIrId9ASv71ugDZ7O6ktSFFssp7UPgI+GZ9grUvCogyVvdBI8XsrYeulSEvtT
rjZ7vNZwXB9AAlIka2Xf0WzhzIPBa1khW3HdOCsazZOw5qJCpBYMUEJ6EYDCGqm3
tbAE0R8Y4jBxLGFrHYzP2cmw+4glqU7Z603mwQSUrI8sLFlYHV+bk7u79nQmYAn6
KjdYLO8NY2huIIYwvIXuh716SY4gcTjq25fP4pc+uokch7Dn2sDjloortZIZITGD
BqkGS9ZTwcuNrJy8cIH40h+bqgDPYtRDxIztUpeWXSD/4cYahjY0CiVp1RNtmZ+Z
UcaujNxsfOZvqFDY3wIDAQABo2MwYTAOBgNVHQ8BAf8EBAMCAqQwDwYDVR0TAQH/
BAUwAwEB/zAdBgNVHQ4EFgQU+1sXHbquOBCJ4d4DvWoMpDhLXV8wHwYDVR0jBBgw
FoAU+1sXHbquOBCJ4d4DvWoMpDhLXV8wDQYJKoZIhvcNAQELBQADggEBAMmfBhfZ
q8UFtv2Zrn0EX0bxKaT/LrcpStqBc+Bf7rV2rZrg0j/ddqWWiYsVfpafrieZqgNL
uz5dR9eJ1XiRgEr3ogGXZ5EEB4n6MNGS+Skaqcb8DIsQEqZ/gkRQV2IIjl46fz5F
0UmSo/Atb8Lc9P5Ik/gVia2Sxw7y/HZIcJwddvDs/IxCrmoakSDnCcNjySp+Dtvm
WBYqSAwFI7ffuqhDTWsOSnWGVU4e6jw9y6sA1c3m7l1uIShn8RmQrzijsJFbfvaF
RV4jU1eOuP7AhY61Z5tgQ15OzithDH92TPHiRi8AgO1sBapkR9WE+DlE4QsBCItg
t7yXU9OWJWWRWQI=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDuzCCAqOgAwIBAgIIYtWxwlTrz/IwDQYJKoZIhvcNAQELBQAwJjEkMCIGA1UE
AwwbaW5ncmVzcy1vcGVyYXRvckAxNzYzNzEzMTE0MB4XDTI1MTEyMTA4MTgzNFoX
DTI3MTEyMTA4MTgzNVowTTFLMEkGA1UEAwxCKi5hcHBzLnJob3BwLXRlc3QtY2x1
c3RlcnBvb2wteGhwODkucmh0YXAuZGV2Y2x1c3Rlci5vcGVuc2hpZnQuY29tMIIB
IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsEbaITeWOVvM5zEFYPzxHv34
wx3qfdcbJprrwmFfu6YXNoWSUyLD37Dfy1neCUtJNJHyMJJbs5NigUAiuZzvzYEe
Nc6d/Puh2AWcdP/ZOMOZHpLSnUbJ4D1lnkHN+osfssPVhVEFQaM+ZCjakkeVWbjb
S7/Nj6SFqNWTZ0kzfmfRDjGTvIy+NWGBsGdM1+eMPiV0MI27fwDxWpr9klKADais
0tGfsYfxUfeuDenEflzFE1QzWdJqS8bw0jrNDpiuLyrSl3ZeJ6dbv5ieQTdldkmG
q0rLfBOg3wySKdA9KMj90DyW7mlRbbQOH9rp0VIutx5CYvtjJkxV0E5RKY4HrQID
AQABo4HFMIHCMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAM
BgNVHRMBAf8EAjAAMB0GA1UdDgQWBBTXicOg0+E6dLvWtiY0OfVXOojG+TAfBgNV
HSMEGDAWgBQv7IeFVljwJzbcvQCJUjcPCs25HTBNBgNVHREERjBEgkIqLmFwcHMu
cmhvcHAtdGVzdC1jbHVzdGVycG9vbC14aHA4OS5yaHRhcC5kZXZjbHVzdGVyLm9w
ZW5zaGlmdC5jb20wDQYJKoZIhvcNAQELBQADggEBAGmM0kUlgQ/ZX1ZGKbo/Tkmh
cKeL6a3uB0UjZCBsN7MemPqCPqPXmDXkTT6r1SdDDXvTiKhNHTxnRdC9I5hcZXhZ
SHJ/sTKtq0oK84XL1tDAF2tYe6Mnmy4LHyHBi5hqlxAwZrXaF1hj9FhuyNXlWhTo
IeldNqrixAziaQR1ihbixTj5Ix2wGBZtdTxyjsvgrWT2ToFQ3SCFoFnRB+B5WwZO
+nyC3NjouLVx7Pwm1BsTLug6iuKjHAKwQeh8a2/n7lNP/lXsj/tKXTtOU+1jRTwO
GoQhRyllBjwlp+ZmIjd3n7nyWki8+Phz9U/HATCcKWcNupoVVzxmUCjV5xspGxU=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDDDCCAfSgAwIBAgIBATANBgkqhkiG9w0BAQsFADAmMSQwIgYDVQQDDBtpbmdy
ZXNzLW9wZXJhdG9yQDE3NjM3MTMxMTQwHhcNMjUxMTIxMDgxODM0WhcNMjcxMTIx
MDgxODM1WjAmMSQwIgYDVQQDDBtpbmdyZXNzLW9wZXJhdG9yQDE3NjM3MTMxMTQw
ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC9nHIw6j9p+E8zXToocMxJ
IzTWLL18zbpIbXxU55mBQBANosN32TudeFqEuHPxysR1zyDEMGgo7OLw5WCE/QPT
hbWtfyihCqC1VcmLD9sB7MGhr7ttmPaNPp6pYKtf61YQqCplOFrcpIouqg96GAQn
EGNIxgPyGk4z4RUSFCLOON1zUw2hfMaZzupEFNbMDlae8Z0zsmAlBraFfjRDu0DJ
9lx6HKpOi2+aiwO2CaSOFNKvn+eZ4uv7c70ca7VmtrRlwocEF4wO25PNF0HQOI5K
/7143opr9RJ39bP9oKMp5C6g+gV5ExP8UTFwLlSBZdtnG1retxjgoKyNfY21X0CB
AgMBAAGjRTBDMA4GA1UdDwEB/wQEAwICpDASBgNVHRMBAf8ECDAGAQH/AgEAMB0G
A1UdDgQWBBQv7IeFVljwJzbcvQCJUjcPCs25HTANBgkqhkiG9w0BAQsFAAOCAQEA
OH8sf3qlGzLJQx1pPaZI3p7z5wXcinDBqmAf8rdmY0F3mdR33jLgAJ7M70cHAGIM
+TSme1N7xFpLk1+pXAoNBR+esy9ejcd3gUMuJ86gDNqX/oCk1YWJx5/sSsBGxsKB
GUffoDMCgqGTpwrRfPct1dEqGUDn3v+laZtgWdvq6G/jM3yiZJU3dIPi4iT2Dupn
hfT2YjjLl6Q3rpZ0i9xh63Jh+ssU0c/fGUMmB47yX5TQfLFszUh9WVFOu17DXXo9
jM9xTyz37GNXH+p/bBSuQ5VXWHQxpze8qWU+Y6AaRGmWuDlIEBMQfTDDNrmKW648
j606Blb2KKJ6BodpxJWMpg==
-----END CERTIFICATE-----
"
export IMAGE_REGISTRY_USER="admin"
export COSIGN_PUBLIC_KEY="LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFRU1ka3VzbklVd3JRUHB2cjRPVnZqMmlpRHpMTgptRlhVYzFITDlxdzNmT1ZSd3N0TkNyeTZ4THRXMHJNK0t2WVVPN0lMcURuemdrQWVQMWg1dHZJRXJnPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="

export TARGET_BRANCH=${TARGET_BRANCH-""}
# conforma
export POLICY_CONFIGURATION=${POLICY_CONFIGURATION-"github.com/conforma/config//rhtap-v0.6"}
#internal, assumes jenkins is local openshift
export REKOR_HOST=${REKOR_HOST-https://rekor-server-tssc-tas.apps.rhopp-test-clusterpool-xhp89.rhtap.devcluster.openshift.com}
export IGNORE_REKOR=${IGNORE_REKOR-false}
export INFO=${INFO-true}
export STRICT=${STRICT-true}
export EFFECTIVE_TIME=${EFFECTIVE_TIME-now}
export HOMEDIR=${HOMEDIR-$(pwd)}
export TUF_MIRROR=${TUF_MIRROR-https://tuf-tssc-tas.apps.rhopp-test-clusterpool-xhp89.rhtap.devcluster.openshift.com}

export CUSTOM_ROOT_CA=${CUSTOM_ROOT_CA-""}

# Allow PR to succeed even if TAS vars not configured
export FAIL_IF_TRUSTIFICATION_NOT_CONFIGURED=false

export SBOMS_DIR=results/sboms